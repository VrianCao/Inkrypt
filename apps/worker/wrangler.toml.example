name = "inkrypt-api"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

workers_dev = false
preview_urls = false

[assets]
# Serve the Vite build output as Static Assets from the same Worker.
directory = "../web/dist"
# SPA mode: when a request doesn't match an asset, return index.html (for HTML navigations).
not_found_handling = "single-page-application"
# Only these routes should invoke the User Worker (Hono). Everything else is served as static assets.
run_worker_first = ["/api/*", "/auth/*", "/healthz*"]

[vars]
RP_NAME = "Inkrypt"
RP_ID = "notes.example.com"
ORIGIN = "https://notes.example.com"
CORS_ORIGIN = "https://notes.example.com"
COOKIE_SAMESITE = "Lax"

[[d1_databases]]
binding = "DB"
database_name = "inkrypt"
database_id = "00000000-0000-0000-0000-000000000000"

[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiterDO"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["RateLimiterDO"]
